{"ast":null,"code":"import _regeneratorRuntime from\"E:/repositories/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/repositories/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"E:/repositories/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{stopSubmit}from\"redux-form\";import{authAPI}from\"../api/api\";var SET_USER_DATA=\"auth/SET-USER-DATA\";var initialState={userId:null,email:null,login:null,isAuth:false,isFetching:false};var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_USER_DATA:{return _objectSpread(_objectSpread({},state),action.payload);}default:{return state;}}};// Action Creators\nexport var setAuthUserData=function setAuthUserData(userId,email,login){var isAuth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return{type:SET_USER_DATA,payload:{userId:userId,email:email,login:login,isAuth:isAuth}};};// Thunk Creators ------------------// thunk\nexport var getAuthUserData=function getAuthUserData(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response,_response$data$data,id,login,email;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return authAPI.me();case 2:response=_context.sent;if(!(response.data.resultCode!==0)){_context.next=5;break;}return _context.abrupt(\"return\");case 5:_response$data$data=response.data.data,id=_response$data$data.id,login=_response$data$data.login,email=_response$data$data.email;dispatch(setAuthUserData(id,email,login,true));case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var login=function login(email,password,rememberMe){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response,serverErrorMessage;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return authAPI.login(email,password,rememberMe);case 2:response=_context2.sent;if(!(response.data.resultCode!==0)){_context2.next=7;break;}serverErrorMessage=response.data.messages.length>0?response.data.messages[0]:\"Some error\";dispatch(stopSubmit(\"user-login\",{_error:serverErrorMessage}));return _context2.abrupt(\"return\");case 7:dispatch(getAuthUserData());case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return authAPI.logout();case 2:response=_context3.sent;if(!(response.data.resultCode!==0)){_context3.next=5;break;}return _context3.abrupt(\"return\");case 5:dispatch(setAuthUserData(null,null,null,false));case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export default authReducer;","map":{"version":3,"sources":["E:/repositories/react-social/src/redux/auth-reducer.js"],"names":["stopSubmit","authAPI","SET_USER_DATA","initialState","userId","email","login","isAuth","isFetching","authReducer","state","action","type","payload","setAuthUserData","getAuthUserData","dispatch","me","response","data","resultCode","id","password","rememberMe","serverErrorMessage","messages","length","_error","logout"],"mappings":"qbAAA,OAASA,UAAT,KAA2B,YAA3B,CACA,OAASC,OAAT,KAAwB,YAAxB,CAEA,GAAMC,CAAAA,aAAa,CAAG,oBAAtB,CAEA,GAAIC,CAAAA,YAAY,CAAG,CACjBC,MAAM,CAAE,IADS,CAEjBC,KAAK,CAAE,IAFU,CAGjBC,KAAK,CAAE,IAHU,CAIjBC,MAAM,CAAE,KAJS,CAKjBC,UAAU,CAAE,KALK,CAAnB,CAQA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAkC,IAAjCC,CAAAA,KAAiC,2DAAzBP,YAAyB,IAAXQ,CAAAA,MAAW,2CACpD,OAAQA,MAAM,CAACC,IAAf,EACE,IAAKV,CAAAA,aAAL,CAAoB,CAClB,sCACKQ,KADL,EAEKC,MAAM,CAACE,OAFZ,EAID,CAED,QAAS,CACP,MAAOH,CAAAA,KAAP,CACD,CAVH,CAYD,CAbD,CAeA;AACA,MAAO,IAAMI,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACV,MAAD,CAASC,KAAT,CAAgBC,KAAhB,CAA0C,IAAnBC,CAAAA,MAAmB,2DAAV,KAAU,CACvE,MAAO,CACLK,IAAI,CAAEV,aADD,CAELW,OAAO,CAAE,CACPT,MAAM,CAANA,MADO,CAEPC,KAAK,CAALA,KAFO,CAGPC,KAAK,CAALA,KAHO,CAIPC,MAAM,CAANA,MAJO,CAFJ,CAAP,CASD,CAVM,CAYP;AACA,MAAO,IAAMQ,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,kGAAM,iBAAOC,QAAP,wLACdf,CAAAA,OAAO,CAACgB,EAAR,EADc,QAC/BC,QAD+B,oBAG/BA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAHE,sFAORF,QAAQ,CAACC,IAAT,CAAcA,IAPN,CAO7BE,EAP6B,qBAO7BA,EAP6B,CAOzBf,KAPyB,qBAOzBA,KAPyB,CAOlBD,KAPkB,qBAOlBA,KAPkB,CASnCW,QAAQ,CAACF,eAAe,CAACO,EAAD,CAAKhB,KAAL,CAAYC,KAAZ,CAAmB,IAAnB,CAAhB,CAAR,CATmC,sDAAN,gEAAxB,CAYP,MAAO,IAAMA,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACD,KAAD,CAAQiB,QAAR,CAAkBC,UAAlB,kGAAiC,kBAAOP,QAAP,6KAC/Bf,CAAAA,OAAO,CAACK,KAAR,CAAcD,KAAd,CAAqBiB,QAArB,CAA+BC,UAA/B,CAD+B,QAChDL,QADgD,qBAEhDA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAFmB,2BAG9CI,kBAH8C,CAIhDN,QAAQ,CAACC,IAAT,CAAcM,QAAd,CAAuBC,MAAvB,CAAgC,CAAhC,CACIR,QAAQ,CAACC,IAAT,CAAcM,QAAd,CAAuB,CAAvB,CADJ,CAEI,YAN4C,CAQlDT,QAAQ,CACNhB,UAAU,CAAC,YAAD,CAAe,CACvB2B,MAAM,CAAEH,kBADe,CAAf,CADJ,CAAR,CARkD,yCAgBpDR,QAAQ,CAACD,eAAe,EAAhB,CAAR,CAhBoD,wDAAjC,kEAAd,CAmBP,MAAO,IAAMa,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,mGAAM,kBAAOZ,QAAP,0JACLf,CAAAA,OAAO,CAAC2B,MAAR,EADK,QACtBV,QADsB,qBAEtBA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAFP,oEAM1BJ,QAAQ,CAACF,eAAe,CAAC,IAAD,CAAO,IAAP,CAAa,IAAb,CAAmB,KAAnB,CAAhB,CAAR,CAN0B,wDAAN,kEAAf,CASP,cAAeL,CAAAA,WAAf","sourcesContent":["import { stopSubmit } from \"redux-form\";\r\nimport { authAPI } from \"../api/api\";\r\n\r\nconst SET_USER_DATA = \"auth/SET-USER-DATA\";\r\n\r\nlet initialState = {\r\n  userId: null,\r\n  email: null,\r\n  login: null,\r\n  isAuth: false,\r\n  isFetching: false,\r\n};\r\n\r\nconst authReducer = (state = initialState, action) => {\r\n  switch (action.type) {\r\n    case SET_USER_DATA: {\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n      };\r\n    }\r\n\r\n    default: {\r\n      return state;\r\n    }\r\n  }\r\n};\r\n\r\n// Action Creators\r\nexport const setAuthUserData = (userId, email, login, isAuth = false) => {\r\n  return {\r\n    type: SET_USER_DATA,\r\n    payload: {\r\n      userId,\r\n      email,\r\n      login,\r\n      isAuth,\r\n    },\r\n  };\r\n};\r\n\r\n// Thunk Creators ------------------// thunk\r\nexport const getAuthUserData = () => async (dispatch) => {\r\n  let response = await authAPI.me();\r\n\r\n  if (response.data.resultCode !== 0) {\r\n    return;\r\n  }\r\n\r\n  let { id, login, email } = response.data.data;\r\n\r\n  dispatch(setAuthUserData(id, email, login, true));\r\n};\r\n\r\nexport const login = (email, password, rememberMe) => async (dispatch) => {\r\n  let response = await authAPI.login(email, password, rememberMe);\r\n  if (response.data.resultCode !== 0) {\r\n    let serverErrorMessage =\r\n      response.data.messages.length > 0\r\n        ? response.data.messages[0]\r\n        : \"Some error\";\r\n\r\n    dispatch(\r\n      stopSubmit(\"user-login\", {\r\n        _error: serverErrorMessage,\r\n      })\r\n    );\r\n    return;\r\n  }\r\n\r\n  dispatch(getAuthUserData());\r\n};\r\n\r\nexport const logout = () => async (dispatch) => {\r\n  let response = await authAPI.logout();\r\n  if (response.data.resultCode !== 0) {\r\n    return;\r\n  }\r\n\r\n  dispatch(setAuthUserData(null, null, null, false));\r\n};\r\n\r\nexport default authReducer;\r\n"]},"metadata":{},"sourceType":"module"}