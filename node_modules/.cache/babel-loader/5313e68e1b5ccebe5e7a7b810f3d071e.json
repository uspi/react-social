{"ast":null,"code":"import _regeneratorRuntime from\"E:/repositories/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/repositories/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"E:/repositories/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"E:/repositories/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{usersAPI}from\"../api/api\";import{updateObjectInArray}from\"../utils/object-helpers\";var FOLLOW=\"FOLLOW\";var UNFOLLOW=\"UNFOLLOW\";var SET_USERS=\"SET-USERS\";var SET_CURRENT_PAGE=\"SET-CURRENT-PAGE\";var SET_TOTAL_USERS_COUNT=\"SET-TOTAL-USERS-COUNT\";var TOGGLE_IS_FETCHING=\"TOGGLE-IS-FETCHING\";var FOLLOWING_IN_PROGRESS=\"FOLLOWING-IN-PROGRESS\";var initialState={users:[],pageSize:10,totalUsersCount:0,currentPage:1,isFetching:true,followingInProgress:[]};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:true})// users: state.users.map((u) => {\n//   if (u.id === action.userId) {\n//     return {\n//       ...u,\n//       followed: true,\n//     };\n//   }\n//   return u;\n// }),\n});case UNFOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:false})});case SET_USERS:return _objectSpread(_objectSpread({},state),{},{users:_toConsumableArray(action.users)});case SET_CURRENT_PAGE:return _objectSpread(_objectSpread({},state),{},{currentPage:action.pageNumber});case SET_TOTAL_USERS_COUNT:return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.totalUsersCount});case TOGGLE_IS_FETCHING:return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});case FOLLOWING_IN_PROGRESS:return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!==action.userId;})});default:return state;}};// action creators\nexport var followSuccess=function followSuccess(userId){return{type:FOLLOW,userId:userId};};export var unfollowSuccess=function unfollowSuccess(userId){return{type:UNFOLLOW,userId:userId};};export var setUsers=function setUsers(users){return{type:SET_USERS,users:users};};export var setCurrentPage=function setCurrentPage(pageNumber){return{type:SET_CURRENT_PAGE,pageNumber:pageNumber};};export var setTotalUsersCount=function setTotalUsersCount(totalUsersCount){return{type:SET_TOTAL_USERS_COUNT,totalUsersCount:totalUsersCount};};export var toggleIsFetching=function toggleIsFetching(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var toggleFollowingProgress=function toggleFollowingProgress(isFetching,userId){return{type:FOLLOWING_IN_PROGRESS,isFetching:isFetching,userId:userId};};// thunks\nexport var requestUsers=function requestUsers(page,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(toggleIsFetching(true));_context.next=3;return usersAPI.getUsers(page,pageSize);case 3:data=_context.sent;dispatch(setUsers(data.items));dispatch(setTotalUsersCount(data.totalCount));dispatch(toggleIsFetching(false));case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:followUnfolowFlow(dispatch,userId,usersAPI.follow.bind(usersAPI),followSuccess);case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:followUnfolowFlow(dispatch,userId,usersAPI.unfollow.bind(usersAPI),unfollowSuccess);case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};// helpers\nvar followUnfolowFlow=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:dispatch(toggleFollowingProgress(true,userId));_context4.next=3;return apiMethod(userId);case 3:response=_context4.sent;if(response.data.resultCode===0){dispatch(actionCreator(userId));}dispatch(toggleFollowingProgress(false,userId));case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function followUnfolowFlow(_x4,_x5,_x6,_x7){return _ref4.apply(this,arguments);};}();export default usersReducer;","map":{"version":3,"sources":["E:/repositories/react-social/src/redux/users-reducer.js"],"names":["usersAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","TOGGLE_IS_FETCHING","FOLLOWING_IN_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","pageNumber","filter","id","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalUsersCount","toggleIsFetching","toggleFollowingProgress","requestUsers","page","dispatch","getUsers","data","items","totalCount","follow","followUnfolowFlow","bind","unfollow","apiMethod","actionCreator","response","resultCode"],"mappings":"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","sourcesContent":["import { usersAPI } from \"../api/api\";\r\nimport { updateObjectInArray } from \"../utils/object-helpers\";\r\n\r\nconst FOLLOW = \"FOLLOW\";\r\nconst UNFOLLOW = \"UNFOLLOW\";\r\nconst SET_USERS = \"SET-USERS\";\r\nconst SET_CURRENT_PAGE = \"SET-CURRENT-PAGE\";\r\nconst SET_TOTAL_USERS_COUNT = \"SET-TOTAL-USERS-COUNT\";\r\nconst TOGGLE_IS_FETCHING = \"TOGGLE-IS-FETCHING\";\r\nconst FOLLOWING_IN_PROGRESS = \"FOLLOWING-IN-PROGRESS\";\r\n\r\nlet initialState = {\r\n  users: [],\r\n  pageSize: 10,\r\n  totalUsersCount: 0,\r\n  currentPage: 1,\r\n  isFetching: true,\r\n  followingInProgress: [],\r\n};\r\n\r\nconst usersReducer = (state = initialState, action) => {\r\n  switch (action.type) {\r\n    case FOLLOW:\r\n      return {\r\n        ...state,\r\n        users: updateObjectInArray(state.users, action.userId, \"id\", {\r\n          followed: true,\r\n        }),\r\n        // users: state.users.map((u) => {\r\n        //   if (u.id === action.userId) {\r\n        //     return {\r\n        //       ...u,\r\n        //       followed: true,\r\n        //     };\r\n        //   }\r\n        //   return u;\r\n        // }),\r\n      };\r\n\r\n    case UNFOLLOW:\r\n      return {\r\n        ...state,\r\n        users: updateObjectInArray(state.users, action.userId, \"id\", {\r\n          followed: false,\r\n        }),\r\n      };\r\n    case SET_USERS:\r\n      return {\r\n        ...state,\r\n        users: [...action.users],\r\n      };\r\n    case SET_CURRENT_PAGE:\r\n      return {\r\n        ...state,\r\n        currentPage: action.pageNumber,\r\n      };\r\n    case SET_TOTAL_USERS_COUNT:\r\n      return {\r\n        ...state,\r\n        totalUsersCount: action.totalUsersCount,\r\n      };\r\n    case TOGGLE_IS_FETCHING:\r\n      return {\r\n        ...state,\r\n        isFetching: action.isFetching,\r\n      };\r\n    case FOLLOWING_IN_PROGRESS:\r\n      return {\r\n        ...state,\r\n        followingInProgress: action.isFetching\r\n          ? [...state.followingInProgress, action.userId]\r\n          : state.followingInProgress.filter((id) => id !== action.userId),\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\n// action creators\r\nexport const followSuccess = (userId) => ({ type: FOLLOW, userId });\r\nexport const unfollowSuccess = (userId) => ({ type: UNFOLLOW, userId });\r\nexport const setUsers = (users) => ({ type: SET_USERS, users });\r\nexport const setCurrentPage = (pageNumber) => ({\r\n  type: SET_CURRENT_PAGE,\r\n  pageNumber,\r\n});\r\nexport const setTotalUsersCount = (totalUsersCount) => ({\r\n  type: SET_TOTAL_USERS_COUNT,\r\n  totalUsersCount,\r\n});\r\nexport const toggleIsFetching = (isFetching) => ({\r\n  type: TOGGLE_IS_FETCHING,\r\n  isFetching,\r\n});\r\nexport const toggleFollowingProgress = (isFetching, userId) => ({\r\n  type: FOLLOWING_IN_PROGRESS,\r\n  isFetching,\r\n  userId,\r\n});\r\n\r\n// thunks\r\nexport const requestUsers = (page, pageSize) => async (dispatch) => {\r\n  dispatch(toggleIsFetching(true));\r\n  let data = await usersAPI.getUsers(page, pageSize);\r\n  dispatch(setUsers(data.items));\r\n  dispatch(setTotalUsersCount(data.totalCount));\r\n  dispatch(toggleIsFetching(false));\r\n};\r\nexport const follow = (userId) => {\r\n  return async (dispatch) => {\r\n    followUnfolowFlow(\r\n      dispatch,\r\n      userId,\r\n      usersAPI.follow.bind(usersAPI),\r\n      followSuccess\r\n    );\r\n  };\r\n};\r\nexport const unfollow = (userId) => {\r\n  return async (dispatch) => {\r\n    followUnfolowFlow(\r\n      dispatch,\r\n      userId,\r\n      usersAPI.unfollow.bind(usersAPI),\r\n      unfollowSuccess\r\n    );\r\n  };\r\n};\r\n\r\n// helpers\r\nconst followUnfolowFlow = async (\r\n  dispatch,\r\n  userId,\r\n  apiMethod,\r\n  actionCreator\r\n) => {\r\n  dispatch(toggleFollowingProgress(true, userId));\r\n  let response = await apiMethod(userId);\r\n  if (response.data.resultCode === 0) {\r\n    dispatch(actionCreator(userId));\r\n  }\r\n  dispatch(toggleFollowingProgress(false, userId));\r\n};\r\n\r\nexport default usersReducer;\r\n"]},"metadata":{},"sourceType":"module"}